name: 'Subdirectory Lake Package Functional Test'
description: |
  Run `lean-action` with the `lake-package-directory` input
  on Lake package generated by `lake init` in a subdirectory of the repository.
runs: 
  using: 'composite'
  steps:
    # TODO: once `lean-action` supports just setup, use it here
    - name: install elan
      run: |
        set -o pipefail
        curl -sSfL https://github.com/leanprover/elan/releases/download/v1.4.2/elan-x86_64-unknown-linux-gnu.tar.gz | tar xz
        ./elan-init -y --default-toolchain leanprover/lean4:v4.8.0-rc1
        echo "$HOME/.elan/bin" >> "$GITHUB_PATH"
      shell: bash

    - name: create Lake package in a_subdirectory
      run: |
        mkdir a_subdirectory
        cd a_subdirectory
        lake init subdirpackage
      shell: bash

    - name: "run `lean-action`" 
      uses: ./
      with:
        test: false
        use-github-cache: false
        lake-package-directory: "a_subdirectory"
